<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<script>


    $(document).ready(function () {


        var readURL = function (input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    $('.avatar').attr('src', e.target.result);
                }

                reader.readAsDataURL(input.files[0]);
            }
        }


        $(".file-upload").on('change', function () {
            readURL(this);
        });
    });
</script>

{{>userheader}}

<section id="page-title" class="page-title">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12">
                <h3>Profile</h3>
            </div>


        </div>

    </div>

</section>


<section style="padding:10px">
    <div class="container bootstrap snippet">

        <ul class="nav nav-tabs">
            <li class="active"><a data-toggle="tab" href="#home">Details</a></li>
            <li><a data-toggle="tab" href="#messages"> Address</a></li>
        </ul>

        <div class="tab-content">
            <div class="tab-pane active" id="home">
                <br>
                <form class="form" action="/profileEditSubmit" method="post" id="profile" enctype="multipart/form-data">
                    <div class="row">
                        <div class="col-sm-3">
                            <div class="form-group text-center">
                                <div class="row">
                                    <img src="/products/{{data.id}}_dp.jpg" class="avatar img-circle img-thumbnail"
                                        alt="avatar" id="imgview1">
                                </div>
                                <div class="row">
                                    <buttlabelon class="btn btn-sm btn-danger" for="file1">Change DP</label>

                                        <input style="display:none" type="file" name="userImage" class="form-control"
                                            data-toggle="modal" data-target="#cropModal"
                                            onchange="return fileValidation1()" id="file1">
                                </div>

                            </div>

                        </div>
                        <div class="col-sm-9">
                            <div class="form-group">
                                <div class="row">

                                    <div class="col-xs-6">
                                        <label for="first_name">
                                            <h6>Name</h6>
                                        </label>
                                        <input type="text" class="form-control" name="first_name" id="firstName"
                                            placeholder="first name" value="{{data.user}}"
                                            title="enter your first name if any.">
                                    </div>
                                    <div class="col-xs-6">
                                        <label for="email">
                                            <h6>Email</h6>
                                        </label>
                                        <input type="email" class="form-control" name="email" id="email"
                                            placeholder="you@email.com" value="{{data.email}}"
                                            title="enter your email.">
                                    </div>

                                </div>
                            </div>

                            <div class="form-group">
                                <div class="row">
                                    <div class="col-xs-6">
                                        <label for="mobile">
                                            <h6>Mobile</h6>
                                        </label>
                                        <input type="text" class="form-control" name="mobile" id="mobile"
                                            placeholder="enter mobile number" value="{{data.contact}}"
                                            title="enter your mobile number if any.">
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="row">
                                    <div class="col-xs-12">
                                        <br>
                                        <button class="btn btn-success" type="submit">Update</button>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                <div class="modal fade" id="cropModal" tabindex="-1" role="dialog "
                    aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLongTitle"
                                    style="color:black; font-weight: bolder;">Crop
                                </h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body" style="color:black; font-weight: lighter;">
                                <div style="width: auto; height: auto;" id="image-box"></div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                <a type="button" class="btn btn-primary" onchange="return fileValidation1()"
                                    id="crop-btn" data-dismiss="modal">Crop</a>
                            </div>
                        </div>
                    </div>
                </div>


                <hr>
            </div>

            <!--/tab-pane-->


            <div class="tab-pane" id="messages">

                <br>

                <div class="row">


                    <div class="billing-address text-center">

                        <h5 class="checkout-box-title">SAVED ADDRESS</h5><hr>

                        <div class="row checkout-billing-adress-box">

                            <div class="col-md-4">
                                <dl>
                                    <dt>1.Coffee</dt>
                                    <dd>Black hot drink</dd>
                                    <dt><input type="checkbox" id="useaddress" placeholder="Use"><span
                                            style="color: #007eff;">
                                            Use Address</span></dt><br>

                                </dl>
                            </div>

                            <div class="col-md-4">
                                <dl>
                                    <dt>1.Coffee</dt>
                                    <dd>Black hot drink</dd>
                                    <dt><input type="checkbox" id="useaddress" placeholder="Use"><span
                                            style="color: #007eff;">
                                            Use Address</span></dt><br>

                                </dl>
                            </div>

                            <div class="col-md-4">
                                <dl>
                                    <dt>1.Coffee</dt>
                                    <dd>Black hot drink</dd>
                                    <dt><input type="checkbox" id="useaddress" placeholder="Use"><span
                                            style="color: #007eff;">
                                            Use Address</span></dt><br>

                                </dl>
                            </div>

                        </div>

                    </div>

                </div>
                <hr><h5 class="checkout-box-title text-center">ADD ADDRESS</h5><hr>
                <div class="row">

                    <form class="form" action="/addNewAddress" method="post" id="addAddress">
                        <div class="form-group">

                            <div class="col-xs-3">
                                <label for="first_name">
                                    <h6>First Name</h6>
                                </label>
                                <input type="text" class="form-control" name="firstName" id="First_Name"
                                    placeholder="first name" title="enter your first name if any.">
                            </div>
                        </div>
                        <div class="form-group">

                            <div class="col-xs-3">
                                <label for="last_name">
                                    <h6>Last Name</h6>
                                </label>
                                <input type="text" class="form-control" name="Last_Name" id="last_name"
                                    placeholder="last name" title="enter your last name if any.">
                            </div>
                        </div>

                        <div class="form-group">

                            <div class="col-xs-6">
                                <label for="last_name">
                                    <h6>Company / House name</h6>
                                </label>
                                <input type="text" class="form-control" name="Company_Name" id="last_name"
                                    placeholder="last name" title="enter your last name if any.">
                            </div>
                        </div>

                        <div class="form-group">

                            <div class="col-xs-6">
                                <label for="phone">
                                    <h6>Address line 1</h6>
                                </label>
                                <input type="text" class="form-control" name="Street_Address" id="Address line 1"
                                    placeholder="Address line 2" title="enter your phone number if any.">
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="col-xs-6">
                                <label for="mobile">
                                    <h6>Address line 2</h6>
                                </label>
                                <input type="text" class="form-control" name="Extra_Details" id="Address line 2"
                                    placeholder="Address line 2" title="enter your mobile number if any.">
                            </div>
                        </div>
                        <div class="form-group">

                            <div class="col-xs-6">
                                <label for="email">
                                    <h6>Town / City</h6>
                                </label>
                                <input type="text" class="form-control" name="Town_City" id="city" placeholder="city"
                                    title="enter your email.">
                            </div>
                        </div>
                        <div class="form-group">

                            <div class="col-xs-6">
                                <label for="email">
                                    <h6>Country / State</h6>
                                </label>
                                <input type="text" class="form-control" name="Country_State" id="state" placeholder="state"
                                    title="enter a location">
                            </div>
                        </div>
                        <div class="form-group">

                            <div class="col-xs-6">
                                <label for="password">
                                    <h6>PIN code</h6>
                                </label>
                                <input type="tele" class="form-control" name="Post_Code" id="pincode"
                                    placeholder="pincode" title="enter your password.">
                            </div>
                        </div>
                        <div class="form-group">

                            <div class="col-xs-3">
                                <label for="password">
                                    <h6>Phone</h6>
                                </label>
                                <input type="tele" class="form-control" name="Phone" id="contact"
                                    placeholder="contact" title="enter your password.">
                            </div>
                        </div>

                        <div class="form-group">

                            <div class="col-xs-3">
                                <label for="password">
                                    <h6>Alternate Phone</h6>
                                </label>
                                <input type="tele" class="form-control" name="Alt_Phone" id="contact"
                                    placeholder="contact" title="enter your password.">
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="col-xs-12 text-center">
                                <br><br>
                                <button class="btn btn-success" type="submit">Submit</button>

                            </div>
                        </div>
                    </form>


                </div>

            </div>
            <!--/tab-content-->


            <!--/col-9-->

        </div>
</section>
{{>userfooter}}



<script>

    function fileValidation1() {
        const imagebox = document.getElementById('image-box')
        const crop_btn = document.getElementById('crop-btn')
        var fileInput = document.getElementById('file1');

        var filePath = fileInput.value;
        var allowedExtensions = /(\.jpg || \.jpeg || \.png)$/i
        if (!allowedExtensions.exec(filePath)) {
            alert('Please upload file having extensions .jpeg only.');
            fileInput.value = '';
            return false;
        } else {
            //Image preview
            const img_data = fileInput.files[0]
            const url = URL.createObjectURL(img_data)
            imagebox.innerHTML = `<img src="${url}" id="image" style="width:100%">`
            const image = document.getElementById('image')
            document.getElementById('image-box').style.display = 'block'
            document.getElementById('crop-btn').style.display = 'block'
            document.getElementById('confirm-btn').style.display = 'none'

            const cropper = new Cropper(image, {
                autoCropArea: 1,
                viewMode: 1,
                scalable: true,
                zoomable: true,
                movable: true,
                aspectRatio: 16 / 9,
                // preview: '.preview',
                minCropBoxWidth: 500,
                minCropBoxHeight: 250,
            })
            crop_btn.addEventListener('click', () => {
                cropper.getCroppedCanvas().toBlob((blob) => {
                    let fileInputElement = document.getElementById('file1');
                    let file = new File([blob], img_data.name, { type: "image/*", lastModified: new Date().getTime() });
                    let container = new DataTransfer();

                    container.items.add(file);
                    console.log(container.files[0])
                    const img = container.files[0]
                    var url = URL.createObjectURL(img)
                    fileInputElement.files = container.files;
                    document.getElementById('imgview1').src = url
                    document.getElementById('image-box').style.display = 'none'
                    document.getElementById('crop-btn').style.display = 'none'
                    document.getElementById('confirm-btn').style.display = 'block'
                });
            });
        }
    }
</script>

<style>
    h6 {
        margin: 23px 0 0;
    }

    input {
        padding: none;
    }
    dl{
        margin:0;
    }
</style>